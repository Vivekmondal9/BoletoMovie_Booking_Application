{"ast":null,"code":"import _regeneratorRuntime from\"/Users/vivekmondal/Documents/VivekMondal_Documents/CI_Final_Exam/Final_Exam_Coding_Invaders/boletomovie/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/vivekmondal/Documents/VivekMondal_Documents/CI_Final_Exam/Final_Exam_Coding_Invaders/boletomovie/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/vivekmondal/Documents/VivekMondal_Documents/CI_Final_Exam/Final_Exam_Coding_Invaders/boletomovie/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";// Replace with your actual API base URL\nfunction fetchWithToken(_x){return _fetchWithToken.apply(this,arguments);}function _fetchWithToken(){_fetchWithToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(url){var options,token,response,refreshToken,refreshResponse,data,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:options=_args.length>1&&_args[1]!==undefined?_args[1]:{};token=localStorage.getItem('access_token');// Get token from local storage\n// If token is available, add it to the request headers\nif(token){options.headers=_objectSpread(_objectSpread({},options.headers),{},{Authorization:\"Bearer \".concat(token)});}_context.next=5;return fetch(\"\".concat(url),options);case 5:response=_context.sent;if(!(response.status===401)){_context.next=23;break;}refreshToken=localStorage.getItem('refresh_token');// Get refresh token from local storage\nif(!refreshToken){_context.next=23;break;}_context.next=11;return fetch(\"http://127.0.0.1:8000/api/refresh/\",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({refresh_token:refreshToken})});case 11:refreshResponse=_context.sent;console.log(refreshResponse);if(!refreshResponse.ok){_context.next=21;break;}_context.next=16;return refreshResponse.json();case 16:data=_context.sent;localStorage.setItem('access_token',data.access_token);return _context.abrupt(\"return\",fetchWithToken(url,options));case 21:localStorage.removeItem(\"access_token\");localStorage.removeItem(\"refresh_token\");case 23:return _context.abrupt(\"return\",response);case 24:case\"end\":return _context.stop();}},_callee);}));return _fetchWithToken.apply(this,arguments);}export{fetchWithToken};","map":{"version":3,"names":["fetchWithToken","_x","_fetchWithToken","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","url","options","token","response","refreshToken","refreshResponse","data","_args","wrap","_callee$","_context","prev","next","length","undefined","localStorage","getItem","headers","_objectSpread","Authorization","concat","fetch","sent","status","method","body","JSON","stringify","refresh_token","console","log","ok","json","setItem","access_token","abrupt","removeItem","stop"],"sources":["/Users/vivekmondal/Documents/VivekMondal_Documents/CI_Final_Exam/Final_Exam_Coding_Invaders/boletomovie/src/API/interceptor.js"],"sourcesContent":["// Replace with your actual API base URL\n\nasync function fetchWithToken(url, options = {}) {\n    const token = localStorage.getItem('access_token'); // Get token from local storage\n\n    // If token is available, add it to the request headers\n    if (token) {\n        options.headers = {\n            ...options.headers,\n            Authorization: `Bearer ${token}`,\n        };\n    }\n\n    const response = await fetch(`${url}`, options);\n    // Check if token expired\n    if (response.status === 401) {\n        const refreshToken = localStorage.getItem('refresh_token'); // Get refresh token from local storage\n        if (refreshToken) {\n            // Fetch new access token using refresh token\n            const refreshResponse = await fetch(`http://127.0.0.1:8000/api/refresh/`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({ refresh_token: refreshToken }),\n            })\n            \n            console.log(refreshResponse);\n\n            if (refreshResponse.ok) {\n                const data = await refreshResponse.json();\n                localStorage.setItem('access_token', data.access_token);\n                return fetchWithToken(url, options);\n            } else {\n                localStorage.removeItem(\"access_token\");\n                localStorage.removeItem(\"refresh_token\");\n            }\n        }\n    }\n\n    return response;\n}\n\nexport { fetchWithToken };"],"mappings":"skBAAA;AAAA,QAEe,CAAAA,cAAcA,CAAAC,EAAA,SAAAC,eAAA,CAAAC,KAAA,MAAAC,SAAA,YAAAF,gBAAA,EAAAA,eAAA,CAAAG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA7B,SAAAC,QAA8BC,GAAG,MAAAC,OAAA,CAAAC,KAAA,CAAAC,QAAA,CAAAC,YAAA,CAAAC,eAAA,CAAAC,IAAA,CAAAC,KAAA,CAAAZ,SAAA,QAAAE,mBAAA,GAAAW,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAEX,OAAO,CAAAM,KAAA,CAAAM,MAAA,IAAAN,KAAA,MAAAO,SAAA,CAAAP,KAAA,IAAG,CAAC,CAAC,CACrCL,KAAK,CAAGa,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAAE;AAEpD;AACA,GAAId,KAAK,CAAE,CACPD,OAAO,CAACgB,OAAO,CAAAC,aAAA,CAAAA,aAAA,IACRjB,OAAO,CAACgB,OAAO,MAClBE,aAAa,WAAAC,MAAA,CAAYlB,KAAK,CAAE,EACnC,CACL,CAACQ,QAAA,CAAAE,IAAA,SAEsB,CAAAS,KAAK,IAAAD,MAAA,CAAIpB,GAAG,EAAIC,OAAO,CAAC,QAAzCE,QAAQ,CAAAO,QAAA,CAAAY,IAAA,MAEVnB,QAAQ,CAACoB,MAAM,GAAK,GAAG,GAAAb,QAAA,CAAAE,IAAA,WACjBR,YAAY,CAAGW,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC,CAAE;AAAA,IACxDZ,YAAY,EAAAM,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UAEkB,CAAAS,KAAK,sCAAuC,CACtEG,MAAM,CAAE,MAAM,CACdP,OAAO,CAAE,CACL,cAAc,CAAE,kBACpB,CAAC,CACDQ,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,aAAa,CAAExB,YAAa,CAAC,CACxD,CAAC,CAAC,SANIC,eAAe,CAAAK,QAAA,CAAAY,IAAA,CAQrBO,OAAO,CAACC,GAAG,CAACzB,eAAe,CAAC,CAAC,IAEzBA,eAAe,CAAC0B,EAAE,EAAArB,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UACC,CAAAP,eAAe,CAAC2B,IAAI,CAAC,CAAC,SAAnC1B,IAAI,CAAAI,QAAA,CAAAY,IAAA,CACVP,YAAY,CAACkB,OAAO,CAAC,cAAc,CAAE3B,IAAI,CAAC4B,YAAY,CAAC,CAAC,OAAAxB,QAAA,CAAAyB,MAAA,UACjD5C,cAAc,CAACS,GAAG,CAAEC,OAAO,CAAC,UAEnCc,YAAY,CAACqB,UAAU,CAAC,cAAc,CAAC,CACvCrB,YAAY,CAACqB,UAAU,CAAC,eAAe,CAAC,CAAC,eAAA1B,QAAA,CAAAyB,MAAA,UAK9ChC,QAAQ,2BAAAO,QAAA,CAAA2B,IAAA,MAAAtC,OAAA,GAClB,UAAAN,eAAA,CAAAC,KAAA,MAAAC,SAAA,GAED,OAASJ,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}